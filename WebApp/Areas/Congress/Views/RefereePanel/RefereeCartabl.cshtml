@using Radyn.Congress.DataStructure
@using Radyn.Congress.Tools
@using Radyn.Utility
@using Radyn.Web.Mvc;
@using Radyn.WebApp.AppCode.Security

@model RefereeCartable
@{
    ViewBag.Title = Resources.Congress.RefereeJudgment;
    Layout = "~/Areas/Congress/Views/Shared/CongressRefereeLayout.cshtml";
}
@section Head{
    <script type="text/javascript">
        $(document).ready(function () {
            ShowAticle();
            ShowAticleFlow();


        });

        function ShowAticleFlow() {

            $.get("@Url.Content("~/Congress/ManagmentPanel/GetArticleFlow")", { articelId: '@Model.ArticleId', filterId: '@SessionParameters.CongressReferee.Id', isReferee:true, date: new Date().getTime() }, function (data) {
                if (data != "false") {
                    $("#divArticleflow").html(data).slideDown("slow");;

                }
                $("#DiveOpration").show();

            });

        }

        function ShowAticle() {
            $.get("@Url.Content("~/Congress/ArticlePanel/GenerateArticle")", { Id: '@Model.ArticleId', Status: "Referee", date: new Date().getTime() }, function (data) {
                if (data != "false") {
                    $("#divarticle").html(data).slideDown("slow");;
                }

            }).complete(function () {
                ArticleSpecialReferee();
            });

        }
        function ArticleSpecialReferee() {
            $("#divArticleReferee").html("");
            $.get("@Url.Content("~/Congress/RefereePanel/GetArticleReferees")", { articleId: '@Model.ArticleId', date: new Date().getTime() }, function (data) {
                if (data != "false") {
                    $("#divArticleReferee").html(data).slideDown("slow");;
                    $("#divArticleReferee").fadeIn("slow");

                }

            }).complete(function () {
                ShowAticleFlow();
            });

        }

        function AssignToReferee() {
            $.post("@Url.Content("~/Congress/RefereePanel/AssignToReferee")", $('form[action^="@Url.Content("~/Congress/RefereePanel/RefereeCartabl")"]').serialize(), function (data) {
                if (data != "false") {
                    window.location = "@Url.Content("~/Congress/RefereePanel/RefereeCartablIndex")";
                    ShowRadynMessage();
                }
            });
            ShowRadynMessage();
        }
        function AnswerArticle() {
            $.post("@Url.Content("~/Congress/RefereePanel/AnswerArticle")", $('form[action^="@Url.Content("~/Congress/RefereePanel/RefereeCartabl")"]').serialize(), function (data) {
                if (data != "false") {
                    window.location = "@Url.Content("~/Congress/RefereePanel/RefereeCartablIndex")";
                    ShowRadynMessage();
                }
            });
            ShowRadynMessage();
        }
    </script>
}
@section PageTitle
{
    @Resources.Congress.RefereeJudgment
}
@section PageAction
{
    <div id="DiveOpration">
        <div class="button-div m-btn waves-green i-save ">
            @{Html.Radyn().ImageActionLink().ImageUrl(Url.Content("~/Content/Images/SendToSecretary.png")).Text(Resources.Common.Save).ImageWidth("15").OtherAttribute(new { onclick = "AnswerArticle();" }).Render(); }
        </div>

        <div class="button-div m-btn waves-red i-return">
            @{Html.Radyn().ImageActionLink().NavigateUrl(Url.Content("~/Congress/RefereePanel/RefereeCartablIndex")).Align(ImageActionLink.Alignment.Left).ImageUrl(Url.Content("~/Content/Images/go-back.png")).ImagePosition(ImageActionLink.Position.Right).Text(@Resources.Common.Return).Render(); }
        </div>
        @if (ViewBag.HasRefereeopinion != null && (bool)ViewBag.HasRefereeopinion)
        {
            <div class="button-div m-btn waves-blue i-message">

                @{Html.Radyn().ImageActionLink().Text(Resources.Congress.RefereeJudgment).Align(ImageActionLink.Alignment.Left).ImageUrl(Url.Content("/Areas/Congress/Content/Images/judge-comments.png")).ImagePosition(ImageActionLink.Position.Right).NavigateUrl(Url.Content("~/Congress/RefereePanel/Refereeopinion?articleId=" + Model.ArticleId)).Render(); }

            </div>
        }

    </div>
}
@section PageActionDown
{
    <div id="DiveOpration1">

        <div class="button-div m-btn waves-green i-save ">
            @{Html.Radyn().ImageActionLink().ImageUrl(Url.Content("~/Content/Images/SendToSecretary.png")).Text(Resources.Common.Save).ImageWidth("15").OtherAttribute(new { onclick = "AnswerArticle();" }).Render(); }
        </div>

        <div class="button-div m-btn waves-red i-return">
            @{Html.Radyn().ImageActionLink().NavigateUrl(Url.Content("~/Congress/RefereePanel/RefereeCartablIndex")).Align(ImageActionLink.Alignment.Left).ImageUrl(Url.Content("~/Content/Images/go-back.png")).ImagePosition(ImageActionLink.Position.Right).Text(@Resources.Common.Return).Render(); }
        </div>
        @if (ViewBag.HasRefereeopinion != null && (bool)ViewBag.HasRefereeopinion)
        {
            <div class="button-div m-btn waves-blue i-message">
                @{ Html.Radyn().ImageActionLink().Text(Resources.Congress.RefereeJudgment).Align(ImageActionLink.Alignment.Left).ImageUrl(Url.Content("/Areas/Congress/Content/Images/judge-comments.png")).ImagePosition(ImageActionLink.Position.Right).NavigateUrl(Url.Content("~/Congress/RefereePanel/Refereeopinion?articleId=" + Model.ArticleId)).Render(); }

            </div>
        }
    </div>
}
<div class="users-page full-size detail-edit">
    <input type="hidden" id="refereeId" name="refereeId" value="@Model.RefereeId" />
    <input type="hidden" id="articleId" name="articleId" value="@Model.ArticleId" />
    <div id="divarticle">
    </div>
    <div id="divFileds">

        <div class="item-input">
            <div class="table-row-cap">
                <div class="item">
                    @Resources.Congress.FinalState

                </div>
            </div>
            <div class="table-row-item readonly">
                <div class="item">
                    @if (Model != null)
                    {
                        @(Model.Status.ToString().ToEnum<Enums.FinalState>().GetDescriptionInLocalization())
                    }
                </div>
            </div>
        </div>

        @if (SessionParameters.CurrentCongress.Configuration.AttachReferee)
        {
            <div class="item-input">
                <div class="table-row-cap table-c-fit">
                    <div class="item">
                        @Resources.Congress.FlowAttachment

                    </div>
                </div>
                <div class="table-row-item table-c-fit readonly">
                    <div class="item">
                        @{
                            Html.RenderAction("FileUploader", "FileUpload", new { area = "FileManager", fileName = "FlowAttachment" });
                        }


                    </div>
                </div>
            </div>
        }
        <div class="item-input">
            <div class="table-row-cap">
                <div class="item">
                    @Resources.Congress.FinalState

                </div>
            </div>
            <div class="table-row-item">
                <div class="item">
                    @if (Model != null)
                    {
                        @Html.DropDownListFor(m => m.State, new SelectList(ViewBag.status, "Key", "Value", (Enums.FinalState)Model.State), new { style = "width:100px" })
                    }
                </div>
            </div>
        </div>
        <div class="fit">
            <div class="item-row fit">
                <div class="table-row-cap ">
                    <div class="item">
                        @Resources.Congress.Description
                    </div>
                </div>
                <div class="table-row-item ">
                    <div class="item">
                        @Html.TextArea("Comments", new {Style = "height:90px;"})
                    </div>
                </div>
            </div>
   
        </div>

       
        <div class="fit" id="divArticleReferee">
        </div>
        @if (SessionParameters.CongressReferee.IsSpecial && SessionParameters.CurrentCongress.Configuration.SentArticleSpecialReferee)
        {

            <div class="button-div" id="sendToRefreeBtn">
                @{Html.Radyn().ImageActionLink().ImageUrl(Url.Content("~/Content/Images/SendToReferee2.png")).Text(Resources.Congress.SentToReferee).ImageWidth("15").OtherAttribute(new { onclick = "AssignToReferee();" }).Render(); }
            </div>
        }

        <div class="fit" id="divArticleflow">
        </div>

    </div>
</div>
