@using Radyn.Congress.Tools
@using Radyn.Utility
@using Radyn.Web.Mvc;
@using Radyn.WebApp.AppCode.Security
@using Radyn.WebApp.Areas.Congress.Tools

@model IEnumerable<Radyn.Congress.DataStructure.User>
    @{
        ViewBag.Title = Resources.Congress.Userlist;
        Layout = "~/Areas/Congress/Views/Shared/CongressUserLayout.cshtml";
    }
    @section Head{
        <script type="text/javascript">

            function SearchUser() {
                ShowPostBackLoader();
                $("#DivResultSearchUser").html("");
                $.post("@Url.Content("~/Congress/UserGroup/Index")", $('form[action^="@Url.Content("~/Congress/UserGroup")"]').serialize(), function (data) {
                    if (data != "false") {
                        $("#DivResultSearchUser").html(data).hide();
                        $("#DivResultSearchUser").slideDown();

                    }
                    ShowRadynMessage();
                }).complete(function () {
                    HidePostBackLoader();

                });
            }

            function PaymentUser() {
                ShowPostBackLoader();
                $.post("@Url.Content("~/Congress/UserGroup/PaymentGroup")", $('form[action^="@Url.Content("~/Congress/UserGroup")"]').serialize(), function (data) {
                    if (data.Result == true) {
                        var object = '@Url.Content("~")';
                        if (object == "/") window.location = data.Url;
                        else window.location = '@Url.Content("~")' + data.Url;
                    }
                    ShowRadynMessage();
                }).complete(function () {
                    HidePostBackLoader();

                });
            }

            function GenerateDiscount() {
                $("#DivDiscount").html("");
                $.get("@Url.Content("~/Payment/DiscountType/GenerateDiscount")", { model: '@AppExtention.CongressMoudelName', section: '@((byte) Enums.PaymentSection.UserRegister)', date: new Date().getTime() }, function (data) {
                    if (data != "false") {
                        $("#DivDiscount").html(data).hide();
                        $("#DivDiscount").slideDown();
                    }

                });

            }

            function SelectChair() {
                var hallId = $("#HallId").val();
                var paymentTypeId = $("#UserPaymentType").val();
                var selectedChairId = $("#SelectedChairId").val();
                if (hallId != "" && paymentTypeId != "") {
                    var count = 0;
                    $("[id^=CheckSelect-]").each(function () {
                        var checked = $(this).attr('checked');
                        if (checked == "checked") {
                            count++;
                        }
                    });
                    if (count == 0) {
                        alert('@Resources.Congress.PleaseSelectUserForReservChair');
                    } else {
                        if (hallId != "") {
                            $.get("@Url.Content("~/Congress/UserGroup/EncryptValue")", { value: count, date: new Date().getTime() }, function (data) {
                                if (data.Result != false) {
                                    ShowModalWithReturnValue("/Reservation/HallChairDesign/LookUpView?hallId=" + hallId + "&onlyselectChairTypeId=" + paymentTypeId + "&selectedId=" + selectedChairId + "&maxselect=" + data.Value,  "SelectedChairId", "SelectedChairId");

                                }

                            });
                        }
                    }
                }
            }
            function ChangeType() {
                var id = $("#UserPaymentType").val();
                $("#DivRegisterType").html("");
                if (id != "") {
                    $.get("@Url.Content("~/Congress/UserRegisterPaymentType/GetRegiterTypeInfo")", { Id: id, date: new Date().getTime() }, function (data) {
                        if (data != "false") {
                            $("#DivRegisterType").html(data).hide();
                            $("#DivRegisterType").slideDown();
                        }

                    });
                }
            }
            function ShowHallImage(Id) {
                showModal('@Url.Content("~/Congress/Configuration/ShowImage?Id=")' + Id, 600, 600);
            }
            $(document).ready(function () {
                SearchUser();
                GenerateDiscount();
                ChangeType();


            });

            function Create() {
                window.location = "@Url.Content("~/Congress/UserGroup/Create")";

            }
        </script>
    }
    @section PageTitle
{
        @Resources.Security.UserName @Resources.Common.List

    }
    @section PageAction
{

        <div class="button-div m-btn waves-yellow i-add">
            @{Html.Radyn().ImageActionLink().Text(Resources.Congress.NewUser).Align(ImageActionLink.Alignment.Left).ImageUrl(Url.Content("~/Content/Images/Add.png")).ImagePosition(ImageActionLink.Position.Right).OtherAttribute(new { onclick = "Create();" }).Render(); }
        </div>
        <div class="button-div m-btn waves-purple i-excel ">
            @{Html.Radyn().ImageActionLink().NavigateUrl(Url.Content("~/Congress/UserGroup/ImportFromExcel")).ImageWidth("20").ImageHeight("20").Text(Resources.Congress.ImportFromExcel).Align(ImageActionLink.Alignment.Left).ImageUrl(Url.Content("~/Content/Images/Microsoft-Office-Excel-icon.png")).ImagePosition(ImageActionLink.Position.Right).Render(); }
        </div>
        @if (SessionParameters.CurrentCongress.Configuration.HasUserPayment)
        {
            <div class="button-div m-btn waves-blue i-payment">
                @{Html.Radyn().ImageActionLink().Text(Resources.Payment.Pay).Align(ImageActionLink.Alignment.Left).ImageUrl(Url.Content("/Areas/Congress/Content/Images/pay.png")).Width("35").Height("35").ImagePosition(ImageActionLink.Position.Right).OtherAttribute(new { onclick = "PaymentUser();" }).Render(); }
            </div>
        }
    }
    @section PageActionDown
{
        <div class="button-div m-btn waves-yellow i-add">
            @{Html.Radyn().ImageActionLink().Text(Resources.Congress.NewUser).Align(ImageActionLink.Alignment.Left).ImageUrl(Url.Content("~/Content/Images/Add.png")).ImagePosition(ImageActionLink.Position.Right).OtherAttribute(new { onclick = "Create();" }).Render(); }
        </div>
        <div class="button-div m-btn waves-purple i-excel ">
            @{Html.Radyn().ImageActionLink().NavigateUrl(Url.Content("~/Congress/UserGroup/ImportFromExcel")).ImageWidth("20").ImageHeight("20").Text(Resources.Congress.ImportFromExcel).Align(ImageActionLink.Alignment.Left).ImageUrl(Url.Content("~/Content/Images/Microsoft-Office-Excel-icon.png")).ImagePosition(ImageActionLink.Position.Right).Render(); }

        </div>
        @if (SessionParameters.CurrentCongress.Configuration.HasUserPayment)
        {
            <div class="button-div m-btn waves-blue i-payment">
                @{Html.Radyn().ImageActionLink().Text(Resources.Payment.Pay).Align(ImageActionLink.Alignment.Left).ImageUrl(Url.Content("/Areas/Congress/Content/Images/pay.png")).Width("35").Height("35").ImagePosition(ImageActionLink.Position.Right).OtherAttribute(new { onclick = "PaymentUser();" }).Render(); }
            </div>
        }
    }
    <div class="radynForm">
        <div class="users-page full-size">
            <input type="hidden" name="SelectedChairId" id="SelectedChairId" />
            <div class="item-input fit">
                <div class="table-row-cap">
                    <div class="item">
                        @Resources.Congress.User
                    </div>
                </div>
                <div class="table-row-item table-fit search-control">
                    <div class="item two-col-row">
                        <div class="m-btn waves-blue i-search icon-btn" id="BtnSearch">
                            <span>
                                @{Html.Radyn().ButtonActionLink().OtherAttribute(new { onclick = "SearchUser();" }).Render(); }
                            </span>
                        </div>
                        <div class="item">
                            @Html.TextBox("txtSearch")


                        </div>
                    </div>
                </div>
            </div>
            <div class="item-input">
                <div class="table-row-cap">
                    <div class="item">
                        @Resources.Congress.Status
                    </div>
                </div>
                <div class="table-row-item">
                    <div class="item">
                        @Html.DropDownList("SearchStatus", new SelectList(ViewBag.SearchstatusList, "Key", "Value"), "")
                    </div>
                </div>
            </div>
            <div class="item-input">
                <div class="table-row-cap">
                    <div class="item">
                        @Resources.EnterPriseNode.Gender
                    </div>
                </div>
                <div class="table-row-item">
                    <div class="item">
                        @Html.DropDownList("Gender", new SelectList(ViewBag.GenderList, "Key", "Value"), "")
                    </div>
                </div>
            </div>
            <div class="item-input">
                <div class="table-row-cap">
                    <div class="item">
                        @Resources.Congress.RegisterDate
                    </div>
                </div>
                <div class="table-row-item">
                    <div class="item ">
                        <div class="page-align date-picker" style="margin-left: 5px; width: 100%">
                            @{Html.Radyn().PersianDateTimePicker().Name("RegisterDate").ID("RegisterDate").Render(); }
                        </div>

                    </div>
                </div>
            </div>

            @if (SessionParameters.CurrentCongress.Configuration.HasUserPayment)
            {
                <input type="hidden" name="SelectedChairId" id="SelectedChairId" />
                <div class="item-input">
                    <div class="table-row-cap">
                        <div class="item">
                            @Resources.Congress.Payment
                        </div>
                    </div>
                    <div class="table-row-item">
                        <div class="item">
                            @Html.DropDownList("UserPaymentType", new SelectList(ViewBag.PaymentTypes, "Id", "DescriptionField"), new { onchange = "ChangeType()" })
                        </div>
                    </div>
                </div>
                <div id="DivRegisterType" style="width: 100%;"></div>
                @*if (SessionParameters.CurrentCongress.Configuration.CanUserSelectChairs && (bool)ViewBag.HasHall)
                    {
                        <div>
                            <div class="table-row-cap">
                                <div class="item" @(SessionParameters.CurrentCongress.Configuration.GetConfigurationContent().HallMapId.HasValue ? "style=cursor:pointer onclick=ShowHallImage('" + SessionParameters.CurrentCongress.Configuration.GetConfigurationContent().HallMapId + "')" : "")>
                                    @Resources.Reservation.Hall @(SessionParameters.CurrentCongress.Configuration.GetConfigurationContent().HallMapId.HasValue ? "(" + Resources.Congress.ViewHallMap + ")" : "")
                                </div>
                            </div>
                            <div class="table-row-item">
                                <div class="item">
                                    @Html.DropDownList("HallId", (SelectList)ViewBag.CongressHalls, "", new { style = "width: 120px" })
                                    <input type="button" onclick=" SelectChair() " value="@Resources.Congress.SelectChair" style="width: 100px" />

                                </div>
                            </div>
                        </div>
                    }*@
            }
            <div class="fit">
                @{
                    Html.RenderAction("GetValidList", "GroupRegisterDiscount", new { area = "Congress" });
                }
            </div>


            <div class="fit" id="DivResultSearchUser">
            </div>
            @if (SessionParameters.CurrentCongress.Configuration.HasUserPayment)
            {
                <div id="DivDiscount" style="width: 100%">
                </div>
            }

        </div>
    </div>
